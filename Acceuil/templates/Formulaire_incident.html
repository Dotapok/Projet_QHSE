{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Dashboard | Ajouter un Incident</title>
    <meta content="" name="description" />
    <meta content="" name="keywords" />

    <!-- Favicons -->
    <link href="{% static 'assets/img/favicon.png' %}" rel="icon" />
    <link href="{% static 'assets/img/apple-touch-icon.png' %}" rel="apple-touch-icon" />

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Vendor CSS Files -->
    <link
      href="{% static 'assets/vendor/bootstrap/css/bootstrap.min.css' %}"
      rel="stylesheet"
    />
    <link
      href="{% static 'assets/vendor/bootstrap-icons/bootstrap-icons.css' %}"
      rel="stylesheet"
    />
    <link href="{% static 'assets/vendor/boxicons/css/boxicons.min.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/quill/quill.snow.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/quill/quill.bubble.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/remixicon/remixicon.css' %}" rel="stylesheet" />
    <link href="{% static 'assets/vendor/simple-datatables/style.css' %}" rel="stylesheet" />

    <!-- Template Main CSS File -->
    <link href="{% static 'assets/css/style.css' %}" rel="stylesheet" />
    <!-- ===============================================-->
    <!--    Stylesheets-->
    <!-- ===============================================-->

    <link href="{% static 'assets/css/theme.min.css' %}" rel="stylesheet" id="style-default" />
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header id="header" class="header fixed-top d-flex align-items-center">
      <div class="d-flex align-items-center justify-content-between">
        <a href="#" class="logo d-flex align-items-center">
          <img src="{% static 'assets/img/logo.png' %}" alt="" />
          <span class="d-none d-lg-block">DIGI QHSE</span>
        </a>
        <i class="bi bi-list toggle-sidebar-btn"></i>
      </div>
      <!-- End Logo -->

      <nav class="header-nav ms-auto">
        <ul class="d-flex align-items-center">
          <li class="nav-item d-block d-lg-none">
            <a class="nav-link nav-icon search-bar-toggle" href="#">
              <i class="bi bi-search"></i>
            </a>
          </li>
          <!-- End Search Icon-->

          <li class="nav-item dropdown">
            <a class="nav-link nav-icon" href="#" data-bs-toggle="dropdown">
              <i class="bi bi-bell"></i>
              <span class="badge bg-primary badge-number">4</span> </a
            ><!-- End Notification Icon -->

            <ul
              class="dropdown-menu dropdown-menu-end dropdown-menu-arrow notifications"
            >
              <li class="dropdown-header">
                You have 4 new notifications
                <a href="#"
                  ><span class="badge rounded-pill bg-primary p-2 ms-2"
                    >View all</span
                  ></a
                >
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li class="notification-item">
                <i class="bi bi-exclamation-circle text-warning"></i>
                <div>
                  <h4>Lorem Ipsum</h4>
                  <p>Quae dolorem earum veritatis oditseno</p>
                  <p>30 min. ago</p>
                </div>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li class="notification-item">
                <i class="bi bi-x-circle text-danger"></i>
                <div>
                  <h4>Atque rerum nesciunt</h4>
                  <p>Quae dolorem earum veritatis oditseno</p>
                  <p>1 hr. ago</p>
                </div>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li class="notification-item">
                <i class="bi bi-check-circle text-success"></i>
                <div>
                  <h4>Sit rerum fuga</h4>
                  <p>Quae dolorem earum veritatis oditseno</p>
                  <p>2 hrs. ago</p>
                </div>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li class="notification-item">
                <i class="bi bi-info-circle text-primary"></i>
                <div>
                  <h4>Dicta reprehenderit</h4>
                  <p>Quae dolorem earum veritatis oditseno</p>
                  <p>4 hrs. ago</p>
                </div>
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>
              <li class="dropdown-footer">
                <a href="#">Show all notifications</a>
              </li>
            </ul>
            <!-- End Notification Dropdown Items -->
          </li>
          <!-- End Notification Nav -->

          <li class="nav-item dropdown pe-3">
            <a
              class="nav-link nav-profile d-flex align-items-center pe-0"
              href="#"
              data-bs-toggle="dropdown"
            >
              <img
                src="{{ profile_image_url }}"
                alt="Profile"
                class="rounded-circle"
              />
              <span class="d-none d-md-block dropdown-toggle ps-2"
                >{{ nom }}</span
              > </a
            ><!-- End Profile Iamge Icon -->

            <ul
              class="dropdown-menu dropdown-menu-end dropdown-menu-arrow profile"
            >
              <li class="dropdown-header">
                <h6>{{ nom }}</h6>
                <span>{{ fonction }}</span>
              </li>
              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <hr class="dropdown-divider" />
              </li>

              <li>
                <a class="dropdown-item d-flex align-items-center" href="{% url 'deconnexionprocessus' %}">
                  <i class="bi bi-box-arrow-right"></i>
                  <span>Se deconnecter</span>
                </a>
              </li>
            </ul>
            <!-- End Profile Dropdown Items -->
          </li>
          <!-- End Profile Nav -->
        </ul>
      </nav>
      <!-- End Icons Navigation -->
    </header>
    <!-- End Header -->

    <!-- ======= Sidebar ======= -->
    <aside id="sidebar" class="sidebar">
      <ul class="sidebar-nav" id="sidebar-nav">
        <ul class="sidebar-nav" id="sidebar-nav">
            <li class="nav-item">
              <a class="nav-link collapsed" href="{% url 'Dashboard' %}">
                <i class="bi bi-grid"></i>
                <span>Dashboard</span>
              </a>
            </li>
            <!-- End Dashboard Nav -->
    
            <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'AjouterAccident' %}">
            <i class="bi bi-journal-text"></i>
            <span>Ajouter un accident</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link " href="{% url 'AjouterIncident' %}">
            <i class="bi bi-journal-text"></i>
            <span>Ajouter un incident</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'tableauAccident' %}">
            <i class="bi bi-journal-text"></i>
            <span>Tableau des accidents</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'tableauAction' %}">
            <i class="bi bi-table"></i>
            <span>Tableau des actions</span>
          </a>
        </li>

        <li class="nav-item">
          <a class="nav-link collapsed" href="{% url 'profile' %}">
            <i class="bi bi-person"></i>
            <span>Profile</span>
          </a>
        </li>
      </ul>
    </aside>
    <!-- End Sidebar-->

    <main id="main" class="main">
      <div class="row">
        <div class="container" data-layout="container">
          <div class="content">
            <div class="row mt-5">
              <div class="col-lg-6 col-xl-12 col-xxl-6 h-100">
                <div class="d-flex mb-4">
                                    <span class="fa-stack me-2 ms-n1"
                    ><i class="fas fa-circle fa-stack-2x text-300"></i
                    ><i
                      class="fa-inverse fa-stack-1x text-primary fas fa-check-double"
                    ></i
                  ></span>
                  <div class="col">
                    <h5 class="mb-0 text-primary position-relative">
                      <span class="bg-200 dark__bg-1100 pe-3"
                        >Formulaire de sauvegarde des incidents, Presqu'accident et premiers soins</span
                      ><span
                        class="border position-absolute top-50 translate-middle-y w-100 start-0 z-n1"
                      ></span>
                    </h5>
                    <p class="mb-0">
                     Donnez les infomations sur votre événement.
                    </p>
                  </div>
                </div>
                <div class="card theme-wizard h-100 mb-5">
                  <div class="card-header bg-body-tertiary pt-3 pb-2">
                    <ul class="nav justify-content-between nav-wizard">
                      <li class="nav-item">
                        <a
                          class="nav-link active fw-semi-bold"
                          href="#bootstrap-wizard-validation-tab1"
                          data-bs-toggle="tab"
                          data-wizard-step="1"
                          ><span class="nav-item-circle-parent"
                            ><span class="nav-item-circle"
                              ><span
                                class="fas fa-car-crash"
                              ></span></span></span
                          ><span class="d-none d-md-block mt-1 fs-10"
                            >Information sur l'événement</span
                          ></a
                        >
                      </li>
                      
                                          
                      <li class="nav-item">
                        <a
                          class="nav-link fw-semi-bold"
                          href="#bootstrap-wizard-validation-tab5"
                          data-bs-toggle="tab"
                          data-wizard-step="5"
                          ><span class="nav-item-circle-parent"
                            ><span class="nav-item-circle"
                              ><span class="fas fa-tools"></span></span></span
                          ><span class="d-none d-md-block mt-1 fs-10"
                            >Plan d'actions</span
                          ></a
                        >
                      </li>
                      <li class="nav-item">
                        <a
                          class="nav-link fw-semi-bold"
                          href="#bootstrap-wizard-validation-tab6"
                          data-bs-toggle="tab"
                          data-wizard-step="6"
                          ><span class="nav-item-circle-parent"
                            ><span class="nav-item-circle"
                              ><span
                                class="fas fa-thumbs-up"
                              ></span></span></span
                          ><span class="d-none d-md-block mt-1 fs-10"
                            >Done</span
                          ></a
                        >
                      </li>
                    </ul>
                  </div>
                  <div class="card-body py-4" id="wizard-controller">
                    <div class="tab-content" data-page="1">
                      <div
                        class="tab-pane active px-sm-3 px-md-5"
                        role="tabpanel"
                        aria-labelledby="bootstrap-wizard-validation-tab1"
                        id="bootstrap-wizard-validation-tab1"
                      >
                        <form
                          class="needs-validation"
                          novalidate="novalidate"
                          data-wizard-form="1"
                        >
                        {% csrf_token %}
                          <div class="row">
                            
                            
                                                        <!-- Type d'événement -->
                      <div class="mb-3 col-12 col-md-6 mb-3">
                        <label for="event-type" class="form-label">Type d'événement</label>
                        <select class="form-control" id="event-type" name="eventType" required>
                          <option>Situation</option>
                          <option>Premier soin</option>
                          <option>Presqu'accident</option>
                        </select>
                        <div class="invalid-feedback">
                          Ce champ est requis.
                        </div>
                      </div>

                                            
                                                <!-- Titre de l'événement -->
                      <div class="mb-3 col-12 col-md-6 mb-3">
                        <label for="event-title" class="form-label">Titre de l'événement</label>
                        <input type="text" class="form-control" id="event-title" name="eventTitle" required >
                      </div>
                            <!-- Date de l'accident -->
                            <div class="col-md-6 mb-3">
                              <label class="form-label" for="accident-date"
                                >Date de l'accident</label
                              >
                              <input
                                class="form-control"
                                type="date"
                                name="accidentDate"
                                id="accident-date" required
                              />
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>

                            <!-- Heure -->
                            <div class="col-md-6 mb-3">
                              <label class="form-label" for="accident-time"
                                >Heure</label
                              >
                              <input
                                class="form-control"
                                type="time"
                                name="accidentTime"
                                id="accident-time" required
                              />
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>


                            <!-- Lieu de l'accident -->
                            <div class="col-12 col-md-6 mb-3 mb-3">
                              <label class="form-label" for="accident-location"
                                >Lieu de l'accident</label
                              >
                              <input
                                class="form-control"
                                type="text"
                                name="accidentLocation"
                                id="accident-location" required
                              />
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>


                            <!-- Nature des lésions -->
                            <div class="col-md-6 mb-3">
                              <label class="form-label" for="nature-of-lesions"
                                >Nature des lésions</label
                              >
                              <input
                                class="form-control"
                                type="text"
                                name="natureOfLesions"
                                id="nature-of-lesions" required
                              />
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>

                            <!-- Sièges des lésions -->
                            <div class="col-md-6 mb-3">
                              <label
                                class="form-label"
                                for="location-of-lesions"
                                >Sièges des lésions</label
                              >
                              <input
                                class="form-control"
                                type="text"
                                name="locationOfLesions"
                                id="location-of-lesions" required
                              />
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>
                            
                            <!-- Actions immédiate aprés l'événement -->
                            <div class="col-12 mb-3">
                              <label
                                class="form-label"
                                for="detailed-circumstances"
                                >Actions immédiate aprés l'événement</label
                              >
                              <textarea
                                class="form-control"
                                name="detailedCircumstances"
                                id="detailed-circumstances" required
                              ></textarea>
                              <div class="invalid-feedback">
                                Ce champ est requis.
                              </div>
                            </div>

                          </div>
                          
                      </div>
                      
                      
                      <div
                        class="tab-pane text-center px-sm-3 px-md-5"
                        role="tabpanel"
                        aria-labelledby="bootstrap-wizard-validation-tab4"
                        id="bootstrap-wizard-validation-tab4"
                      >
                        <div class="row">
                          <div class="mb-3">
                            <button
                              type="button"
                              class="btn btn-primary"
                            >
                              AJOUTER UNE CAUSE
                            </button>
                          </div>

                          <div id="dropdown-container" class="row"></div>
                      </div>                     
                    </div>
                    <div
                    class="tab-pane text-center px-sm-3 px-md-5"
                    role="tabpanel"
                    aria-labelledby="bootstrap-wizard-validation-tab5"
                    id="bootstrap-wizard-validation-tab5"
                    data-page="2"
                  >
                    <form class="form-validation" data-wizard-form="5">
                      <div class="row">
                      <div class="mb-3">
                        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#actionModal">
                          Ajouter une action
                        </button>
                      </div>
                      <table class="table" id="actionsTable">
                        <thead>
                          <tr>
                            <th>Titre</th>
                            <th>Description</th>
                            <th>Responsable</th>
                            <th>Statut</th>
                            <th>Date de début</th>
                            <th>Date de fin</th>
                            <th>Actions</th> <!-- Colonne pour les boutons d'action comme supprimer -->
                          </tr>
                          
                        </thead>
                        <tbody>
                          <!-- Les lignes seront ajoutées ici par JavaScript -->
                        </tbody>
                      </table>
                    </form>
                  </div>
                  
                </div>
                <div
                class="tab-pane text-center px-sm-3 px-md-5"
                role="tabpanel"
                aria-labelledby="bootstrap-wizard-validation-tab6"
                id="bootstrap-wizard-validation-tab6"
              >

              <div class="tab-pane text-center px-sm-3 px-md-5" role="tabpanel" aria-labelledby="bootstrap-wizard-validation-tab4" id="bootstrap-wizard-validation-tab4">
                <div class="wizard-success-wrapper">
                  <div class="success-icon mx-auto my-3"><i class="fas fa-check-circle fa-4x text-success"></i></div>
                  <h4 class="mb-1">Votre incident a été enregistré avec succès!</h4>
                  <p>Vous pouvez maintenant consulter les statistiques et informations sur vos incidents.</p>
                  <a class="btn btn-primary px-5 my-3" href="{% url 'Dashboard' %}">Voir le Tableau de Bord</a>
                </div>
            </div>

              </div>
            </div>
                  
                  <div class="card-footer bg-body-tertiary">
                    <div class="px-sm-3 px-md-5">
                      <ul class="pager wizard list-inline mb-0">
                        <li class="previous">
                          <button class="btn btn-link ps-0" type="button">
                            <span
                              class="fas fa-chevron-left me-2"
                              data-fa-transform="shrink-3"
                            ></span
                            >Précédent
                          </button>
                        </li>
                        <li class="next">
                          <button
                            class="btn btn-primary px-5 px-sm-6"
                            id="nextButton"
                            onclick="changerAttributsBouton()"
                          >
                            Suivant<span
                              class="fas fa-chevron-right ms-2"
                              data-fa-transform="shrink-3"
                            >
                            </span>
                          </button>
                        </li>
                      </ul>
                    </div>
                  </div>
                </div>
              </form>
              </div>
        
              <div
                class="modal fade"
                id="error-modal"
                tabindex="-1"
                role="dialog"
                aria-hidden="true"
              >
                <div
                  class="modal-dialog modal-dialog-centered"
                  role="document"
                  style="max-width: 400px"
                >
                  <div class="modal-content position-relative p-5">
                    <div class="d-flex align-items-center">
                      <div class="me-3">
                        <i class="fas fa-exclamation-triangle text-warning"></i>
                    </div>
                      <div class="flex-1">
                        <button
                          class="btn btn-link text-danger position-absolute top-0 end-0 mt-2 me-2"
                          data-bs-dismiss="modal"
                        >
                          <span class="fas fa-times"></span>
                        </button>
                        <p class="mb-0">
                          Les données du formulaire ont été sauvegardées avec succès dans la base de données. Par conséquent, l'accès à ce lien n'est désormais plus disponible. 
                        </p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="modal fade" id="actionModal" tabindex="-1" aria-labelledby="actionModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="actionModalLabel">Ajouter une action</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <!-- Formulaire dans le modal -->
              <form id="actionForm">
                <div class="mb-3">
                  <label for="action-title" class="form-label">Titre de l'action</label>
                  <input type="text" class="form-control" id="action-title" name="actionTitle" required>
                </div>
                <div class="mb-3">
                  <label for="action-description" class="form-label">Description</label>
                  <textarea class="form-control" id="action-description" name="actionDescription" required></textarea>
                </div>
                <div class="mb-3">
                  <label for="action-responsible" class="form-label">Responsable</label>
                  <select class="form-control" id="action-responsible" name="actionResponsible">
                    <option>Aucun</option>
                    <option>Yvan</option>
                    <option>Paul</option>
                    <option>Yannick</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="action-status" class="form-label">Statut</label>
                  <select class="form-control" id="action-status" name="actionStatus">
                    <option>Ouvert</option>
                    <option>En cours</option>
                    <option>Terminé</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label for="action-start-date" class="form-label">Date de début</label>
                  <input type="date" class="form-control" id="action-start-date" name="actionStartDate">
                </div>
                <div class="mb-3">
                  <label for="action-end-date" class="form-label">Date de fin</label>
                  <input type="date" class="form-control" id="action-end-date" name="actionEndDate">
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" id="modalActionButton" onclick="addAction()">Ajouter l'action</button>
            </div>
          </div>
        </div>
      </div>
    </main>
    <!-- End #main -->

    <!-- Vendor JS Files -->
    <!-- Vendor JS Files -->
    <script src="{% static 'assets/vendor/php-email-form/validate.js' %}"></script>
    <script src="{% static 'assets/vendor/fontawesome/all.min.js' %}"></script>
    <script src="{% static 'assets/vendor/lodash/lodash.min.js' %}"></script>
    <script src="{% static 'assets/js/theme.js' %}"></script>
    <script src="{% static 'assets/vendor/bootstrap/js/bootstrap2.min.js' %}"></script>
    <script src="{% static 'assets/vendor/anchorjs/anchor.min.js' %}"></script>

    <!-- Template Main JS File -->
    <script src="{% static 'assets/js/main.js' %}"></script>
    <script>

      function changerAttributsBouton() {
        var bouton = document.getElementById("nextButton");

        bouton.className = "btn btn-success"; 
        bouton.innerHTML = "Enregistrer l'incident";
        bouton.onclick = submitForm;
      }

  // Fonction pour ajouter une action au tableau
function addAction() {
  // Récupérer les données du formulaire
  var title = document.getElementById('action-title').value;
  var description = document.getElementById('action-description').value;
  var responsible = document.getElementById('action-responsible').value;
  var status = document.getElementById('action-status').value;
  var startDate = document.getElementById('action-start-date').value;
  var endDate = document.getElementById('action-end-date').value;

  // Créer une nouvelle ligne dans le tableau
  var table = document.getElementById('actionsTable');
  var row = table.insertRow();
  row.innerHTML = `
    <td>${title}</td>
    <td>${description}</td>
    <td>${responsible}</td>
    <td>${status}</td>
    <td>${startDate}</td>
    <td>${endDate}</td>
    <td>
      <i class="fas fa-edit text-primary" style="cursor:pointer;" onclick="editAction(this)"></i>
      <i class="fas fa-trash-alt text-danger" style="cursor:pointer;" onclick="deleteAction(this)"></i>
    </td>
  `;
  // Réinitialisez le texte du bouton et la fonction appelée
  document.getElementById('modalActionButton').innerText = "Ajouter l'action";
  document.getElementById('modalActionButton').setAttribute("onclick", "addAction()");

  // Fermer le modal
  var modal = bootstrap.Modal.getInstance(document.getElementById('actionModal'));
  modal.hide();

  // Réinitialiser le formulaire
  document.getElementById('actionForm').reset();
}

function deleteAction(icon) {
  var row = icon.parentNode.parentNode;
  row.parentNode.removeChild(row);
}

function editAction(icon) {
  var row = icon.parentNode.parentNode.cells;
  document.getElementById('action-title').value = row[0].innerText;
  document.getElementById('action-description').value = row[1].innerText;
  document.getElementById('action-responsible').value = row[2].innerText;
  document.getElementById('action-status').value = row[3].innerText;
  document.getElementById('action-start-date').value = row[4].innerText;
  document.getElementById('action-end-date').value = row[5].innerText;

  // Stocker l'index de la ligne en cours de modification
  document.getElementById('actionModal').setAttribute('data-row-index', icon.parentNode.parentNode.rowIndex);

  // Afficher le modal pour édition
  var actionModal = new bootstrap.Modal(document.getElementById('actionModal'));
  actionModal.show();

   // Changez le texte du bouton et la fonction appelée
   document.getElementById('modalActionButton').innerText = "Modifier l'action";
  document.getElementById('modalActionButton').setAttribute("onclick", "updateAction()");
}

function updateAction() {
  var rowIndex = document.getElementById('actionModal').getAttribute('data-row-index');
  var table = document.getElementById('actionsTable');
  var row = table.rows[rowIndex];

  row.cells[0].innerText = document.getElementById('action-title').value;
  row.cells[1].innerText = document.getElementById('action-description').value;
  row.cells[2].innerText = document.getElementById('action-responsible').value;
  row.cells[3].innerText = document.getElementById('action-status').value;
  row.cells[4].innerText = document.getElementById('action-start-date').value;
  row.cells[5].innerText = document.getElementById('action-end-date').value;

  // Fermer le modal après la mise à jour
  var actionModal = bootstrap.Modal.getInstance(document.getElementById('actionModal'));
  actionModal.hide();
}

document.addEventListener('DOMContentLoaded', function () {
  var forms = document.querySelectorAll('.needs-validation');
  Array.prototype.slice.call(forms).forEach(function (form) {
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });
});

function submitForm() {
  // Récupérer les données du premier onglet du formulaire
  var eventType = document.getElementById('event-type').value;
  var eventTitle = document.getElementById('event-title').value;
  var accidentDate = document.getElementById('accident-date').value;
  var accidentTime = document.getElementById('accident-time').value;
  var accidentLocation = document.getElementById('accident-location').value;
  var natureOfLesions = document.getElementById('nature-of-lesions').value;
  var locationOfLesions = document.getElementById('location-of-lesions').value;
  var detailedCircumstances = document.getElementById('detailed-circumstances').value;

  // Récupérer les données du troisième onglet du formulaire
  var informationActions = [];
  var table = document.getElementById('actionsTable');
  var actionsTableRows = table.rows;

  for (var i = 1; i < actionsTableRows.length; i++) {
      var cells = actionsTableRows[i].cells;
      
      var actionData = {
          title: cells[0].innerText,
          description: cells[1].innerText,
          responsible: cells[2].innerText,
          status: cells[3].innerText,
          startDate: cells[4].innerText,
          endDate: cells[5].innerText
      };

      informationActions.push(actionData);
  }

  // Convert the array to a JSON-formatted string
  var actionsDataString = JSON.stringify(informationActions, null, 2);

  // Organiser les données dans un objet
  var formData = {
    eventType: eventType,
    eventTitle: eventTitle,
    accidentDate: accidentDate,
    accidentTime: accidentTime,
    accidentLocation: accidentLocation,
    natureOfLesions: natureOfLesions,
    locationOfLesions: locationOfLesions,
    detailedCircumstances: detailedCircumstances,
    informationActions: actionsDataString
  };


  var csrfTokenInput = document.querySelector('input[name="csrfmiddlewaretoken"]');
  var jetonCsrf = csrfTokenInput ? csrfTokenInput.value : null;
  var bouton = document.getElementById("nextButton");

  axios.post('{% url 'AjouterIncidentProcessus' %}', formData, {
    headers: {
        'Content-Type': 'multipart/form-data',
        'X-CSRFToken': jetonCsrf
    }
  })
    .then(function (response) {
      alert("Incident enregistré avec succes.");
    })
    .catch(function (error) {
      alert('Impossible de soumettre la requete,Verifier votre formulaire.');
    }).finally(function () {
      bouton.disabled = false;
      bouton.innerHTML = "Suivant";;
  });
} 
    </script>
  </body>
</html>
