{% load static %}
<!DOCTYPE html>
<html data-bs-theme="light" lang="en-US" dir="ltr">

  
<!-- Mirrored from prium.github.io/falcon/v3.19.0/pages/authentication/card/login.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 28 Dec 2023 08:58:54 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- ===============================================--><!--    Document Title--><!-- ===============================================-->
    <title>QHSE EXPERT | Inscription</title>

    <!-- ===============================================--><!--    Favicons--><!-- ===============================================-->
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'assets/img/apple-touch-icon.png' %}">
    <link rel="icon" type="image/ico" sizes="32x32" href="{% static 'assets/img/favicon.ico' %}">
    <link rel="icon" type="image/ico" sizes="16x16" href="{% static 'assets/img/favicon.ico' %}">
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'assets/img/favicon.ico' %}">
    <link rel="manifest" href="{% static 'assets/img/manifest.json' %}">
    <meta name="theme-color" content="#ffffff">

    <!-- ===============================================--><!--    Stylesheets--><!-- ===============================================-->
    <!-- Google Fonts -->
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i" rel="stylesheet">
    <link href="{% static 'assets/vendor/simplebar/simplebar.min.css' %}" rel="stylesheet">
    <link href="{% static 'assets/css/theme-rtl.min.css' %}" rel="stylesheet" id="style-rtl">
    <link href="{% static 'assets/css/theme.min.css' %}" rel="stylesheet" id="style-default">
    <link href="{% static 'assets/css/user-rtl.min.css' %}" rel="stylesheet" id="user-style-rtl">
    <link href="{% static 'assets/css/user.min.css' %}" rel="stylesheet" id="user-style-default">
    <script>
      var isRTL = JSON.parse(localStorage.getItem('isRTL'));
      if (isRTL) {
        var linkDefault = document.getElementById('style-default');
        var userLinkDefault = document.getElementById('user-style-default');
        linkDefault.setAttribute('disabled', true);
        userLinkDefault.setAttribute('disabled', true);
        document.querySelector('html').setAttribute('dir', 'rtl');
      } else {
        var linkRTL = document.getElementById('style-rtl');
        var userLinkRTL = document.getElementById('user-style-rtl');
        linkRTL.setAttribute('disabled', true);
        userLinkRTL.setAttribute('disabled', true);
      }
    </script>
      <!-- Inclusion d'Axios depuis un CDN -->
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  </head>

  <body>
    <!-- ===============================================--><!--    Main Content--><!-- ===============================================-->
    <main class="main" id="companyInfo">
      <div class="container-fluid">
        <div class="row min-vh-100 flex-center g-0">
          <div class="col-lg-8 col-xxl-5 py-3 position-relative"><img class="bg-auth-circle-shape" src="{% static 'assets/img/bg-shape.png' %}" alt="" width="250"><img class="bg-auth-circle-shape-2" src="{% static 'assets/img/shape-1.png' %}" alt="" width="150">
            <div class="card overflow-hidden z-1">
              <div class="card-body p-0">
                <div class="row g-0 h-100">
                  <div class="col-md-5 text-center bg-card-gradient">
                    <div class="position-relative p-1 pt-md-5 pb-md-7" data-bs-theme="light">
                      <div class="bg-holder bg-auth-card-shape" style="background-image:url({% static 'assets/img/half-circle.png' %});"></div><!--/.bg-holder-->
                      <div class="z-1 position-relative"><p class="link-light mb-1 font-sans-serif fs-5 d-inline-block fw-bolder">QHSE EXPERT</a>
                        <p class="opacity-75 text-white">Pour tirer le meilleur parti de nos services personnalisés, nous vous invitons à enregistrer les informations essentielles de votre entreprise. Commencez dès maintenant pour définir le parcours de l'excellence QHSE avec nous. Après avoir configuré les détails de votre entreprise, vous serez guidé pour fournir les informations concernant l'administrateur principal qui gérera votre compte.
                        </p>
                      </div>
                    </div>
                    <div class="mt-1 mb-1 mt-md-1 mb-md-1" data-bs-theme="light">
                      <p class="text-white">Vous avez déja un compte ?<br><a class="text-decoration-underline link-light" href="{% url 'connexion' %}">Connectez-vous !</a></p>
                      <p class="mb-0 mt-1 mt-md-5 fs-10 fw-semi-bold text-white opacity-75">Lire et accepter les  <a class="text-decoration-underline text-white" href="#!">termes et conditions</a></p>
                    </div>
                  </div>
                  <div class="col-md-7 d-flex flex-center">
                    <div class="p-4 p-md-5 flex-grow-1">
                      <div class="row flex-between-center">
                        <div class="col-auto">
                          <h3>Informations sur l'entreprise</h3>
                        </div>
                      </div>
                      <form class="row g-3 needs-validation" novalidate name="companyForm">
                        <div class="col-md-12">
                          <label for="nomEntreprise" class="form-label">Nom de l'entreprise</label>
                          <input type="text" name="nomEntreprise" class="form-control" id="nomEntreprise" required>
                        </div>
                        <div class="col-md-12">
                          <label for="logoEntreprise" class="form-label">Logo de l'entreprise (facultatif)</label>
                          <input type="file" name="logoEntreprise" class="form-control" id="logoEntreprise">
                        </div>
                        <div class="col-md-12">
                          <label for="description" class="form-label">Description</label>
                          <textarea name="description" class="form-control" id="description" required></textarea>
                        </div>
                        <div class="col-md-6">
                          <label for="nombreEmploye" class="form-label">Nombre d'employés</label>
                          <input type="number" name="nombreEmploye" class="form-control" id="nombreEmploye" required>
                        </div>
                        <div class="col-md-6">
                          <label for="secteurActivite" class="form-label">Secteur d'activité</label>
                          <select name="secteurActivite" class="form-select" id="secteurActivite" required>
                            <option selected disabled value="">Choisir...</option>
                            <option value="Technologie">Technologie</option>
                            <option value="Finance">Finance</option>
                            <option value="Santé">Santé</option>
                          </select>
                        </div>
                        <div class="col-md-12">
                          <label for="adresse" class="form-label">Adresse</label>
                          <input type="text" name="adresse" class="form-control" id="adresse" required>
                        </div>
                        <div class="col-md-6">
                          <label for="telephoneEntreprise" class="form-label">Téléphone</label>
                          <input type="tel" name="telephone" class="form-control" id="telephoneEntreprise" required>
                        </div>
                        <div class="col-md-6">
                          <label for="emailEntreprise" class="form-label">Email</label>
                          <input type="email" name="email" class="form-control" id="emailEntreprise" required>
                        </div>
                      </form>
                      <div class="d-flex justify-content-end mt-2">
                        <button class="btn btn-primary" type="button" onclick="showNextForm()">Suivant > </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main><!-- ===============================================--><!--    End of Main Content--><!-- ===============================================-->
    <main class="main" id="adminInfo" style="display:none;">
      <div class="container-fluid">
        <div class="row min-vh-100 flex-center g-0">
          <div class="col-lg-8 col-xxl-5 py-1 position-relative"><img class="bg-auth-circle-shape" src="{% static 'assets/img/bg-shape.png' %}" alt="" width="250"><img class="bg-auth-circle-shape-2" src="{% static 'assets/img/shape-1.png' %}" alt="" width="150">
            <div class="card overflow-hidden z-1">
              <div class="card-body p-0">
                <div class="row g-0 h-100">
                  <div class="col-md-5 text-center bg-card-gradient">
                    <div class="position-relative p-4 pt-md-5 pb-md-7" data-bs-theme="light">
                      <div class="bg-holder bg-auth-card-shape" style="background-image:url({% static 'assets/img/half-circle.png' %});"></div><!--/.bg-holder-->
                      <div class="z-1 position-relative"><p class="link-light mb-4 font-sans-serif fs-5 d-inline-block fw-bolder">QHSE EXPERT</a>
                        <p class="opacity-75 text-white">Continuer en enregistrant les informations sur l'administrateur principal de votre entreprise pour configurer et gérer votre compte. 

                        </p>
                      </div>
                    </div>
                    <div class="mt-1 mb-1 mt-md-1 mb-md-1" data-bs-theme="light">
                      <p class="text-white">Vous avez déja un compte ?<br><a class="text-decoration-underline link-light" href="{% url 'connexion' %}">Connectez-vous !</a></p>
                      <p class="mb-0 mt-1 mt-md-5 fs-10 fw-semi-bold text-white opacity-75">Lire et accepter les  <a class="text-decoration-underline text-white" href="#!">termes et conditions</a></p>
                    </div>
                  </div>
                  <div class="col-md-7 d-flex flex-center">
                    <div class="p-2 p-md-5 flex-grow-1">
                      <div class="row flex-between-center">
                        <div class="col-auto">
                          <h3>Informations administrateur</h3>
                        </div>
                      </div>
                      <form class="row g-3 needs-validation" novalidate name="adminForm">
                    
                        <div class="col-md-12">
                          <label for="nomAdmin" class="form-label">Nom</label>
                          <input type="text" name="nom" class="form-control" id="nomAdmin" required>
                        </div>
                        <div class="col-md-12">
                          <label for="fonction" class="form-label">Fonction</label>
                          <input type="text" name="fonction" class="form-control" id="fonction" required>
                        </div>
                        <div class="col-md-12">
                          <!-- On doit se rassurer que le backend peut gérer les fichiers envoyés -->
                          <label for="imgProfil" class="form-label">Profil admin (facultatif)</label>
                          <input type="file" name="imgProfil" class="form-control" id="imgProfil">
                        </div>
                        <div class="col-md-6">
                          <label for="emailAdmin" class="form-label">Email</label>
                          <input type="email" name="email" class="form-control" id="emailAdmin" required>
                        </div>
                        <div class="col-md-6">
                          <label for="telephoneAdmin" class="form-label">Téléphone</label>
                          <input type="tel" name="telephone" class="form-control" id="telephoneAdmin" required>
                        </div>
                        <div class="col-md-6">
                          <label for="mdp" class="form-label">Mot de passe</label>
                          <input type="password" name="mdp" class="form-control" id="mdp" required>
                        </div>
                        <!-- Le champ confirmMdp n'est pas envoyé au serveur, mais utilisé pour la validation côté client -->
                        <div class="col-md-6">
                          <label for="confirmMdp" class="form-label">Ressaisir mot de passe</label>
                          <input type="password" class="form-control" id="confirmMdp" required>
                        </div>
                        <!-- Le champ typeCompte doit être défini en fonction de la logique de votre application -->
                        <!-- Assurez-vous que la valeur correspond à une des options valides selon le backend -->
                        <input type="hidden" name="typeCompte" value="admin">
                        <!-- entrepriseID sera ajouté dynamiquement par le script JS lors de la soumission du formulaire -->
                        <!-- ... Reste du formulaire ... -->
                      </form>
                      <div class="d-flex justify-content-between mt-2">
                        <button class="btn btn-secondary" type="button" onclick="showPreviousForm()"> Précédent</button>
                        <button class="btn btn-primary" type="submit" id="submitButton">Créer le compte</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
       <!-- ===============================================--><!--    JavaScripts--><!-- ===============================================-->
    <script src="{% static 'assets/vendor/popper/popper.min.js' %}"></script>
    <script src="{% static 'assets/vendor/bootstrap/bootstrap.min.js' %}"></script>
    <script src="{% static 'assets/vendor/anchorjs/anchor.min.js' %}"></script>
    <script src="{% static 'assets/vendor/is/is.min.js' %}"></script>
    <script src="{% static 'assets/vendor/fontawesome/all.min.js' %}"></script>
    <script src="{% static 'assets/vendor/lodash/lodash.min.js' %}"></script>
    <script src="../../../../../../polyfill.io/v3/polyfill.min58be.js?features=window.scroll"></script>
    <script src="{% static 'assets/vendor/list.js/list.min.js' %}"></script>
    <script src="{% static 'assets/js/theme.js' %}"></script>
      <!-- Template Main JS File -->
  <script src="{% static 'assets/js/main.js' %}"></script>
    <script>
      // Fonction pour lire et afficher l'image sélectionnée
      function readURL(input, previewId) {
    if (input.files && input.files[0]) {
      var reader = new FileReader();
      reader.onload = function(e) {
        var previewImage = document.getElementById(previewId);
        previewImage.src = e.target.result;
        previewImage.classList.remove('invisible');
        previewImage.classList.add('visible');
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
      
      // Fonction pour valider les champs des formulaires
      function validateForms() {
    var companyForm = document.forms['companyForm'];
    var adminForm = document.forms['adminForm'];
  
    if (!companyForm.checkValidity() || !adminForm.checkValidity()) {
      // Si les formulaires ne sont pas valides, affiche les messages de validation
      companyForm.classList.add('was-validated');
      adminForm.classList.add('was-validated');
      return false;
    } else {
      // Si les formulaires sont valides, procédez à la soumission ou à une autre logique
      console.log('Tous les formulaires sont valides.');
      // Ici, vous pouvez par exemple soumettre les formulaires
      return true;
    }
  }
  
      // Attachez la fonction validateForms au bouton de soumission
      document.getElementById('submitButton').addEventListener('click', function(event) {
        event.preventDefault(); // Prévenir la soumission standard pour la validation personnalisée
        validateForms();
      });
      document.getElementById('submitButton').addEventListener('click', function(event) {
    event.preventDefault(); // Prévenir la soumission standard pour la validation personnalisée
    var mdp = document.getElementById('mdp').value;
    var confirmMdp = document.getElementById('confirmMdp').value;
    if (mdp === confirmMdp) {
      // Les mots de passe correspondent, vous pouvez soumettre le formulaire ou faire une autre logique.
      validateForms();
    } else {
      // Les mots de passe ne correspondent pas, affichez un message d'erreur.
      document.getElementById('confirmMdp').classList.add('is-invalid');
      document.querySelector('#confirmMdp + .invalid-feedback').style.display = 'block';
    }
  });
      document.getElementById('emailEntreprise').addEventListener('blur', function() {
    if (!this.validity.valid) {
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-invalid');
    }
  });
      document.getElementById('emailAdmin').addEventListener('blur', function() {
        if (!this.validity.valid) {
          this.classList.add('is-invalid');
        } else {
          this.classList.remove('is-invalid');
        }
      });
      document.getElementById('telephoneEntreprise').addEventListener('blur', function() {
    // Regex pour un numéro de téléphone (exemple basique)
    var regexTel = /^[0-9]{10}$/;
    if (!regexTel.test(this.value)) {
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-invalid');
    }
  });
  
      document.getElementById('adresse').addEventListener('blur', function() {
    // Regex pour une adresse 
    var regexAdresse = /.+/; 
    if (!regexAdresse.test(this.value)) {
      this.classList.add('is-invalid');
    } else {
      this.classList.remove('is-invalid');
    }
  });
      </script>
  
  <script>
    const companyForm = document.forms['companyForm'];
    const adminForm = document.forms['adminForm'];
    
    // URL des endpoints
    const urlCompany = 'https://dotapok237.eu.pythonanywhere.com/api/authentification/creerEntreprise';
    const urlAdmin = 'https://dotapok237.eu.pythonanywhere.com/api/authentification/creerCompteUtilisateur';
    
    // Fonction pour envoyer des données à l'endpoint de l'entreprise avec Axios
    async function sendCompanyData() {
    // Convertir FormData en JSON
    const object = {};
    for (let field of companyForm.elements) {
      if (field.name) {  
        object[field.name] = field.value;
      }
    }
    const jsonData = JSON.stringify(object);
  
    console.log("Sending to company endpoint:", jsonData); // Log pour débogage
  
  
    try {
      const response = await axios.post(urlCompany, jsonData, {
        headers: {
          'Content-Type': 'application/json' // Définir le type de contenu en JSON
        }
      });
      console.log("Company Data Response:", response.data);
      return response.data;
    } catch(error) {
      console.error('Error in sendCompanyData:', error);
    }
  }
    
    // Fonction pour envoyer des données à l'endpoint de l'utilisateur avec Axios
    async function sendAdminData(entrepriseID) {
    // Convertir FormData en JSON
    const object = {};
    adminForm.forEach((value, key) => {object[key] = value});
    object['entrepriseID'] = entrepriseID;  // Ajouter entrepriseID au JSON
    const jsonData = JSON.stringify(object);
  
    console.log("Sending to admin endpoint:", jsonData); // Log pour débogage
  
    try {
      const response = await axios.post(urlAdmin, jsonData, {
        headers: {
          'Content-Type': 'application/json' // Définir le type de contenu en JSON
        }
      });
      console.log("Admin Data Response:", response.data);
      return response.data;
    } catch(error) {
      console.error('Error in sendAdminData:', error);
    }
  }
    
    // Fonction asynchrone pour gérer la soumission des deux formulaires
    async function handleFormSubmit(event) {
      event.preventDefault();
    
      try {
        const companyData = await sendCompanyData(); // Attendre la création de l'entreprise
        if (companyData && companyData.entrepriseID) { // Supposons que entrepriseID est l'identifiant retourné
          await sendAdminData(companyData.entrepriseID); // Attendre la création de l'administrateur
        } else {
          // Gérer le cas où l'entreprise n'est pas créée correctement
          console.error('Erreur lors de la création de l\'entreprise');
        }
      } catch (error) {
        console.error('Erreur lors de la soumission des formulaires :', error);
      }
    }
    
    // Attachez la fonction handleFormSubmit au bouton de soumission
    document.getElementById('submitButton').addEventListener('click', handleFormSubmit);

    // JavaScript pour contrôler l'affichage des formulaires
function showNextForm() {
  document.getElementById('companyInfo').style.display = 'none';
  document.getElementById('adminInfo').style.display = 'block';
}

function showPreviousForm() {
  document.getElementById('companyInfo').style.display = 'block';
  document.getElementById('adminInfo').style.display = 'none';
}

</script>
</body>


<!-- Mirrored from prium.github.io/QHSE EXPERT/v3.19.0/pages/authentication/card/login.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 28 Dec 2023 08:58:54 GMT -->
</html>